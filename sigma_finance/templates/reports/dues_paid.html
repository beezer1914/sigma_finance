{% extends "base.html" %}

{% block content %}
<div class="container-fluid my-4">
    <div class="row mb-3">
        <div class="col-md-12">
            <h1 class="display-5">üí∞ Dues Paid Report</h1>
            <p class="text-muted">Detailed payment information for all members</p>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="row mb-3">
        <div class="col-md-12">
            <a href="{{ url_for('reports.reports_dashboard') }}" class="btn btn-secondary me-2">
                ‚Üê Back to Reports
            </a>
            <a href="{{ url_for('reports.export_dues_paid') }}" class="btn btn-success">
                üì• Export to CSV
            </a>
        </div>
    </div>

    <!-- Summary Alert -->
    <div class="row mb-3">
        <div class="col-md-12">
            <div class="alert alert-info">
                <strong>Summary:</strong>
                {{ summary.financial_members }} of {{ summary.total_members }} members are financial
                ({{ "%.1f"|format(summary.financial_members / summary.total_members * 100 if summary.total_members > 0 else 0) }}%)
                |
                <strong>Total Collected This Year:</strong> ${{ "%.2f"|format(summary.total_collected_this_year) }}
            </div>
        </div>
    </div>

    <!-- Data Table -->
    <div class="row">
        <div class="col-md-12">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Status</th>
                                    <th class="text-end">Current Year</th>
                                    <th class="text-end">All Time</th>
                                    <th class="text-center">Payments</th>
                                    <th>Last Payment</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for member in members %}
                                <tr class="{% if member.financial_status == 'financial' or member.financial_status == 'neophyte' %}table-success{% elif member.financial_status == 'not financial' %}table-warning{% endif %}">
                                    <td>{{ member.name }}</td>
                                    <td>{{ member.email }}</td>
                                    <td>
                                        <span class="badge {% if member.financial_status == 'financial' %}bg-success{% elif member.financial_status == 'neophyte' %}bg-info{% else %}bg-warning text-dark{% endif %}">
                                            {{ member.financial_status|title }}
                                        </span>
                                    </td>
                                    <td class="text-end fw-bold">${{ "%.2f"|format(member.current_year_paid) }}</td>
                                    <td class="text-end">${{ "%.2f"|format(member.total_paid) }}</td>
                                    <td class="text-center">
                                        <span class="badge bg-secondary">{{ member.payment_count }}</span>
                                    </td>
                                    <td>
                                        {% if member.last_payment_date %}
                                            {{ member.last_payment_date.strftime('%Y-%m-%d') }}
                                        {% else %}
                                            <span class="text-muted">Never</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
