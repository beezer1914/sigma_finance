services:
  - type: web
    name: sigma-finance
    env: python
    envVars:
      - key: FLASK_APP
        value: sigma_finance.app
      - key: VITE_RECAPTCHA_SITE_KEY
        sync: false  # Pull value from Render dashboard
    buildCommand: |
      echo "----> Building React frontend..." &&
      cd react-frontend &&
      npm install &&
      npm run build &&
      echo "----> React build output:" &&
      ls -la dist/ &&
      cd .. &&
      echo "----> Installing Python dependencies..." &&
      pip install -r requirements.txt &&
      echo "----> Verifying React build exists at runtime path:" &&
      ls -la react-frontend/dist/ &&
      echo "----> running Postgres migrationsâ€¦" &&
      FLASK_APP=sigma_finance.app flask db upgrade
    startCommand: gunicorn sigma_finance.wsgi:app

  - type: cron
    name: payment-reminders
    env: python
    schedule: "0 9 * * *"  # Every day at 9:00 AM UTC
    buildCommand: pip install -r requirements.txt
    startCommand: python -m sigma_finance.utils.reminder
